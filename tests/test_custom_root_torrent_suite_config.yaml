---
dialect: python
resource_uri: mockiontorrent.com
user: ionadmin
password: ionadmin

root_projection_uri: '/rundb/api/v1/results/1/'

snp_variants_vcf_prototype: &snp_variants_vcf_prototype
  type: file
  children: None
  name:  " 'SNP_variants.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/SNP_variants.vcf'])"

small_variants_sorted_vcf_prototype: &small_variants_sorted_vcf_prototype
  type: file
  children: None
  name:  " 'small_variants.sorted.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/small_variants.sorted.vcf'])"

small_variants_filtered_vcf_prototype: &small_variants_filtered_vcf_prototype
  type: file
  children: None
  name:  " 'small_variants_filtered.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/small_variants_filtered.vcf'])"

small_variants_vcf_prototype: &small_variants_vcf_prototype
  type: file
  children: None
  name:  " 'small_variants.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/small_variants.vcf'])"

small_variants_left_vcf_prototype: &small_variants_left_vcf_prototype
  type: file
  children: None
  name:  " 'small_variants.left.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/small_variants.left.vcf'])"

indel_assembly_vcf_prototype: &indel_assembly_vcf_prototype
  type: file
  children: None
  name:  " 'indel_assembly.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/indel_assembly.vcf'])"

all_merged_vcf_prototype: &all_merged_vcf_prototype
  type: file
  children: None
  name:  " 'all.merged.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/all.merged.vcf'])"

indel_variants_vcf_prototype: &indel_variants_vcf_prototype
  type: file
  children: None
  name:  " 'indel_variants.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/indel_variants.vcf'])"

tsvc_vcf_prototype: &tsvc_vcf_prototype
  type: file
  children: None
  name:  " 'TSVC_variants.vcf' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , $.context[2].experiment.plan.barcodedSamples[$.context[0].name].barcodes[0], '/TSVC_variants.vcf'])"

local_settings_prototype: &local_settings_prototype
  type: file
  children: None
  name:  " 'variant_caller_settings.json' "
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/local_parameters.json' ])"

bed_prototype: &bed_prototype
  type: file
  children: None
  name:  "split($.environment.store.targets_bed, '/')[-1]"
  uri: "join(['/auth/output/Home/', split($.context[1].filesystempath,'/')[-1] , '/plugin_out/' , split($.path, '/')[-1], '/' , split($.store.targets_bed, '/')[-1]])"

plugin_result_prototype: &plugin_result_prototype
  type: directory
  children:
    bed_prototype: *bed_prototype
    local_settings_prototype: *local_settings_prototype
    tsvc_vcf_prototype: *tsvc_vcf_prototype
    indel_variants_vcf_prototype: *indel_variants_vcf_prototype
    all_merged_vcf_prototype: *all_merged_vcf_prototype
    indel_assembly_vcf_prototype: *indel_assembly_vcf_prototype
    small_variants_left_vcf_prototype: *small_variants_left_vcf_prototype
    small_variants_vcf_prototype: *small_variants_vcf_prototype
    small_variants_filtered_vcf_prototype: *small_variants_filtered_vcf_prototype
    small_variants_sorted_vcf_prototype: *small_variants_sorted_vcf_prototype
    snp_variants_vcf_prototype: *snp_variants_vcf_prototype
  name: "split($.path, '/')[-1]"
  uri: " $.context[0].pluginresults[@.pluginName is 'variantCaller' and 'VFNA' not in @.pluginName].resource_uri"

bam_prototype: &bam_prototype
  type: file
  children: None
  name:  " str($.environment.name)+'.bam' "
  uri: "join(['/auth/output/Home/', split($.context[0].filesystempath, '/')[-1], '/', $.context[1].experiment.plan.barcodedSamples[$.name].barcodes[0], '_rawlib.bam'])"

sample_metadata_prototype: &sample_metadata_prototype
  type: file
  children: None
  name:  " 'metadata.json' "
  uri: '$.resource_uri'

sample_prototype: &sample_prototype
  type: directory
  children:
    sample_metadata_prototype: *sample_metadata_prototype
    plugin_result_prototype: *plugin_result_prototype
    bam_prototype: *bam_prototype
  name: "$.name"
  uri: "$.experiment.samples.resource_uri"

root:
  type: directory
  children:
    sample_prototype: *sample_prototype
  name: "split($.filesystempath, '/')[-1]"
  uri: "$.resource_uri"
